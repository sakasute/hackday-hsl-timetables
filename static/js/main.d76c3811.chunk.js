(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{32:function(e,n,t){e.exports=t(52)},52:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),o=t(2),c=t.n(o),i=t(30),l=t(3),s=t(4),u=t(6),d=t(11),m=t(10),f=t(17),p=t.n(f),g=t(25),b=t(8),h=t(26),y=t(27);function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(n,t){navigator.geolocation.getCurrentPosition(n,t,e)})}var E=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||b.c,O=Object(b.d)(function(e,n){switch(n.type){case"FETCH_START":return Object(m.a)({},e,{loading:!0});case"FETCH_SUCCESS":return Object(m.a)({},e,{loading:!1,nearbyTimetables:n.payload.stopsByRadius.edges.map(function(e){return Object(m.a)({},e.node.stop,{distance:e.node.distance})})});case"LOCATION_UPDATED":return Object(m.a)({},e,{geolocation:n.payload});default:return e}},{loading:!1,response:null,swipeStatus:"INITIAL"},E(Object(b.a)(y.a)));function w(){var e=Object(l.a)(["\n  list-style: none;\n  padding-left: 0;\n\n  li {\n    padding: 5px 0;\n    font-weight: normal;\n  }\n"]);return w=function(){return e},e}var T=s.b.ul(w()),j=function(e){var n=e.stoptimes,t=new Date,a=n.map(function(e){return r.a.createElement("li",{key:e.realtimeArrival},"".concat(e.trip.routeShortName," ").concat(e.headsign," (").concat(function(e,n){var a=new Date(1e3*n),r=Math.floor((t.getTime()-a.getTime())/1e3);return Math.max(Math.floor((e-r)/60),0)}(e.realtimeArrival,e.serviceDay)," min)"))});return r.a.createElement(T,null,a)};function S(){var e=Object(l.a)(["\n  margin: 0 0 1em 0;\n"]);return S=function(){return e},e}function I(){var e=Object(l.a)(["\n  margin: 0.5em 0 0.5em 0;\n  font-weight: normal;\n"]);return I=function(){return e},e}function N(){var e=Object(l.a)(["\n  vertical-align: top;\n"]);return N=function(){return e},e}var C=s.b.article(N()),D=s.b.h2(I()),k=s.b.h3(S()),_=function(e){var n=e.stopInfo;return r.a.createElement(C,null,r.a.createElement(D,null,"".concat(n.name,", ").concat(n.code," (").concat(n.distance," m)")),r.a.createElement(k,null,n.desc),r.a.createElement(j,{stoptimes:n.stoptimesWithoutPatterns}))};function A(){var e=Object(l.a)(["\n  html {\n    background-color: lightgray;\n  }\n\n  body {\n    margin: 0;\n    font-family: sans-serif;\n    font-weight: bold;\n  }\n"]);return A=function(){return e},e}var x=Object(s.a)(A()),P=Object(u.d)({accessToken:"pk.eyJ1Ijoic2FrYXN1dGUtYWxtYSIsImEiOiJjanZ4aGc2OG8wNHM3NDNycnNyNTBhOThlIn0.70Nsp4cpsqajXtCLiFS5aA"});var F=d.b(function(e){return{nearbyTimetables:e.nearbyTimetables,loading:e.loading,geolocation:e.geolocation}},function(e){return{fetchNearbyTimetables:function(){return e(function(){var e=Object(g.a)(p.a.mark(function e(n){var t,a,r,o,c,i,l;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n({type:"FETCH_START"}),t=window.location.href,a=new URL(t),r=a.searchParams.get("lat"),o=a.searchParams.get("lon"),c=a.searchParams.get("radius"),r&&o){e.next=16;break}return console.log("geolocation start"),e.next=10,v();case 10:i=e.sent,console.log("geolocation end",i),r=i.coords.latitude,o=i.coords.longitude,e.next=18;break;case 16:r=parseFloat(r),o=parseFloat(o);case 18:c||(c=500),n({type:"LOCATION_UPDATED",payload:{lat:r,lon:o}}),l="{\n    stopsByRadius(lat:".concat(r,", lon:").concat(o,", radius:").concat(c,") {\n      edges {\n        node {\n          stop {\n            gtfsId\n            name\n            code\n            desc\n            lat\n            lon\n              stoptimesWithoutPatterns {\n              scheduledArrival\n              realtimeArrival\n              arrivalDelay\n              scheduledDeparture\n              realtimeDeparture\n              departureDelay\n              realtime\n              realtimeState\n              serviceDay\n              headsign\n              trip {\n                routeShortName\n                directionId\n              } \n            }\n          }\n          distance\n        }\n      }\n    }\n  }"),console.log("query start"),Object(h.request)("https://api.digitransit.fi/routing/v1/routers/hsl/index/graphql",l).then(function(e){return n({type:"FETCH_SUCCESS",payload:e})}).catch(function(e){return console.log(e)}).finally(function(){return console.log("query end")});case 23:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}())}}})(function(e){var n=e.geolocation,t=e.nearbyTimetables,a=e.loading,o=e.fetchNearbyTimetables,c=window.location.href,l=new URL(c).searchParams.get("zoom");l||(l=15.5),r.a.useEffect(function(){o()},[o]);var s=r.a.useState(null),d=Object(i.a)(s,2),m=d[0],f=d[1];return r.a.createElement("main",null,r.a.createElement(x,null),a||!t?r.a.createElement("p",null,"loading..."):r.a.createElement(P,{style:"mapbox://styles/mapbox/light-v9",containerStyle:{height:"100vh",width:"100vw"},center:[n.lon,n.lat],zoom:[l],onClick:function(){return f(null)}},r.a.createElement(u.b,{type:"circle",id:"geolocation",paint:{"circle-radius":15,"circle-color":"#ff512c"}},r.a.createElement(u.a,{coordinates:[n.lon,n.lat]})),r.a.createElement(u.b,{type:"symbol",id:"stops",layout:{"icon-image":"bus-15","icon-size":1.5}},t.map(function(e){return r.a.createElement(u.a,{key:e.gtfsId,coordinates:[e.lon,e.lat],onClick:function(){return f(e)}})})),m&&r.a.createElement(u.c,{coordinates:[m.lon,m.lat]},r.a.createElement(_,{key:m.gtfsId,stopInfo:m}))))});c.a.render(r.a.createElement(d.a,{store:O},r.a.createElement(F,null)),document.getElementById("root"))}},[[32,1,2]]]);
//# sourceMappingURL=main.d76c3811.chunk.js.map