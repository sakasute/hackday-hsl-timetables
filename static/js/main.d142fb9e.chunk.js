(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{32:function(e,n,t){e.exports=t(52)},52:function(e,n,t){"use strict";t.r(n);var a=t(0),o=t.n(a),r=t(2),c=t.n(r),i=t(30),l=t(3),s=t(4),u=t(6),m=t(11),d=t(10),f=t(17),p=t.n(f),g=t(25),b=t(8),h=t(26),y=t(27);function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(n,t){navigator.geolocation.getCurrentPosition(n,t,e)})}var E=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||b.c,w=Object(b.d)(function(e,n){switch(n.type){case"FETCH_START":return Object(d.a)({},e,{loading:!0});case"FETCH_SUCCESS":return Object(d.a)({},e,{loading:!1,nearbyTimetables:n.payload.stopsByRadius.edges.map(function(e){return Object(d.a)({},e.node.stop,{distance:e.node.distance})})});case"LOCATION_UPDATED":return Object(d.a)({},e,{isCustomLocation:n.payload.isCustomLocation,geolocation:n.payload.position});default:return e}},{loading:!1,response:null,swipeStatus:"INITIAL"},E(Object(b.a)(y.a)));function O(){var e=Object(l.a)(["\n  list-style: none;\n  padding-left: 0;\n\n  li {\n    padding: 5px 0;\n    font-weight: normal;\n  }\n"]);return O=function(){return e},e}var T=s.b.ul(O()),C=function(e){var n=e.stoptimes,t=new Date,a=n.map(function(e){return o.a.createElement("li",{key:e.realtimeArrival},"".concat(e.trip.routeShortName," ").concat(e.headsign," (").concat(function(e,n){var a=new Date(1e3*n),o=Math.floor((t.getTime()-a.getTime())/1e3);return Math.max(Math.floor((e-o)/60),0)}(e.realtimeArrival,e.serviceDay)," min)"))});return o.a.createElement(T,null,a)};function S(){var e=Object(l.a)(["\n  margin: 0 0 1em 0;\n"]);return S=function(){return e},e}function j(){var e=Object(l.a)(["\n  margin: 0.5em 0 0.5em 0;\n  font-weight: normal;\n"]);return j=function(){return e},e}function D(){var e=Object(l.a)(["\n  vertical-align: top;\n"]);return D=function(){return e},e}var L=s.b.article(D()),k=s.b.h2(j()),I=s.b.h3(S()),_=function(e){var n=e.stopInfo,t=e.isCustomLocation?"".concat(n.name,", ").concat(n.code):"".concat(n.name,", ").concat(n.code," (").concat(n.distance," m)");return o.a.createElement(L,null,o.a.createElement(k,null,t),o.a.createElement(I,null,n.desc),o.a.createElement(C,{stoptimes:n.stoptimesWithoutPatterns}))};function P(){var e=Object(l.a)(["\n  html {\n    background-color: lightgray;\n  }\n\n  body {\n    margin: 0;\n    font-family: sans-serif;\n    font-weight: bold;\n  }\n"]);return P=function(){return e},e}var A=Object(s.a)(P()),x=window.location.href,N=new URL(x),R=N.searchParams.get("zoom");R||(R=15.5);var U=N.searchParams.get("accessToken"),F=Object(u.d)({accessToken:U});var q=m.b(function(e){return{nearbyTimetables:e.nearbyTimetables,loading:e.loading,geolocation:e.geolocation,isCustomLocation:e.isCustomLocation}},function(e){return{fetchNearbyTimetables:function(){return e(function(){var e=Object(g.a)(p.a.mark(function e(n){var t,a,o,r,c,i,l,s;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n({type:"FETCH_START"}),t=window.location.href,a=new URL(t),o=!0,r=a.searchParams.get("lat"),c=a.searchParams.get("lon"),i=a.searchParams.get("radius"),r&&c){e.next=18;break}return console.log("geolocation start"),e.next=11,v();case 11:l=e.sent,console.log("geolocation end",l),r=l.coords.latitude,c=l.coords.longitude,o=!1,e.next=20;break;case 18:r=parseFloat(r),c=parseFloat(c);case 20:i||(i=500),n({type:"LOCATION_UPDATED",payload:{isCustomLocation:o,position:{lat:r,lon:c}}}),s="{\n    stopsByRadius(lat:".concat(r,", lon:").concat(c,", radius:").concat(i,") {\n      edges {\n        node {\n          stop {\n            gtfsId\n            name\n            code\n            desc\n            lat\n            lon\n              stoptimesWithoutPatterns {\n              scheduledArrival\n              realtimeArrival\n              arrivalDelay\n              scheduledDeparture\n              realtimeDeparture\n              departureDelay\n              realtime\n              realtimeState\n              serviceDay\n              headsign\n              trip {\n                routeShortName\n                directionId\n              } \n            }\n          }\n          distance\n        }\n      }\n    }\n  }"),console.log("query start"),Object(h.request)("https://api.digitransit.fi/routing/v1/routers/hsl/index/graphql",s).then(function(e){return n({type:"FETCH_SUCCESS",payload:e})}).catch(function(e){return console.log(e)}).finally(function(){return console.log("query end")});case 25:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}())}}})(function(e){var n=e.geolocation,t=e.isCustomLocation,a=e.nearbyTimetables,r=e.loading,c=e.fetchNearbyTimetables;o.a.useEffect(function(){c()},[c]);var l=o.a.useState(null),s=Object(i.a)(l,2),m=s[0],d=s[1];return o.a.createElement("main",null,o.a.createElement(A,null),r||!a?o.a.createElement("p",null,"loading..."):o.a.createElement(F,{style:"mapbox://styles/mapbox/light-v9",containerStyle:{height:"100vh",width:"100vw"},center:[n.lon,n.lat],zoom:[R],onClick:function(){return d(null)}},!t&&o.a.createElement(u.b,{type:"circle",id:"geolocation",paint:{"circle-radius":15,"circle-color":"#ff512c"}},o.a.createElement(u.a,{coordinates:[n.lon,n.lat]})),o.a.createElement(u.b,{type:"symbol",id:"stops",layout:{"icon-image":"bus-15","icon-size":1.5}},a.map(function(e){return o.a.createElement(u.a,{key:e.gtfsId,coordinates:[e.lon,e.lat],onClick:function(){return d(e)}})})),m&&o.a.createElement(u.c,{coordinates:[m.lon,m.lat]},o.a.createElement(_,{key:m.gtfsId,stopInfo:m,isCustomLocation:t}))))});c.a.render(o.a.createElement(m.a,{store:w},o.a.createElement(q,null)),document.getElementById("root"))}},[[32,1,2]]]);
//# sourceMappingURL=main.d142fb9e.chunk.js.map